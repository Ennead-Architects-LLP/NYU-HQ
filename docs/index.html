<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">Area Report - Loading...</title>
    <link rel="stylesheet" href="styles.css">
    <!-- Load Chart.js from CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- EnneadTab Logo - Lower Left with Parallax -->
    <div class="ennead-logo-container" id="enneadLogo">
        <img src="icon_logo_dark_background.png" alt="EnneadTab Logo" class="ennead-logo" onerror="this.onerror=null; this.src='../icon_logo_dark_background.png';">
    </div>
    
    <!-- Main Container -->
    <div class="container" id="mainContainer">
        <!-- Main Header -->
        <header class="main-header">
            <h1 id="reportTitle">üè• Loading Report...</h1>
            <div class="report-info">
                <p><strong>Generated:</strong> <span id="generatedTime">Loading...</span></p>
                <p><strong>Project:</strong> <span id="projectName">Loading...</span></p>
            </div>
        </header>
        
        <!-- Scheme Content Container (populated by JavaScript) -->
        <div id="schemeContentContainer"></div>
        
        <!-- Footer -->
        <footer class="report-footer">
            <p>Report generated by Monitor Area System | <span id="footerTime">Loading...</span></p>
            <p style="margin-top: 10px; font-size: 0.9em; color: #9ca3af;">
                ü¶Ü Powered by <strong style="color: #60a5fa;">EnneadTab</strong> | 
                For feature requests, contact <strong style="color: #60a5fa;">Sen Zhang</strong>
            </p>
        </footer>
    </div>
    
    <!-- Right-Click Context Menu -->
    <div id="contextMenu" class="context-menu">
        <!-- Search Bar -->
        <div class="context-menu-search">
            <input type="text" id="searchInput" placeholder="üîç Search (Dept/Division/Room)..." autocomplete="off" />
        </div>
        <!-- Suggestions Dropdown (appears above search bar) -->
        <div id="searchSuggestions" class="search-suggestions"></div>
        
        <div class="context-menu-item" onclick="returnToTop()">
            <span class="context-menu-icon">‚¨ÜÔ∏è</span>
            <span>Return to Top</span>
        </div>
        <div class="context-menu-item" onclick="expandAllViews()">
            <span class="context-menu-icon">‚ñº</span>
            <span>Expand All</span>
        </div>
        <div class="context-menu-item" onclick="collapseAllViews()">
            <span class="context-menu-icon">‚ñ≤</span>
            <span>Collapse All</span>
        </div>
    </div>
    
    <!-- Minimap Navigation Panel -->
    <div class="minimap-toggle" onclick="toggleMinimap()" title="Toggle Navigation Panel">
        üó∫Ô∏è Nav
    </div>
    <nav class="minimap-nav" id="minimapNav">
        <!-- Populated by JavaScript -->
    </nav>
    
    <!-- Load JavaScript -->
    <script src="scripts.js"></script>
    
    <!-- Data Loading Script -->
    <script>
        // Determine which data file to load based on HTML filename
        function getDataFilename() {
            const htmlFilename = window.location.pathname.split('/').pop();
            
            // If the HTML file is named area_report_consolidated_TIMESTAMP.html,
            // load data_TIMESTAMP.json
            const timestampMatch = htmlFilename.match(/area_report_consolidated_(\d{8}_\d{6})\.html/);
            if (timestampMatch) {
                return 'data_' + timestampMatch[1] + '.json';
            }
            
            // Default to latest
            return 'data_latest.json';
        }
        
        // Load data and initialize report
        const dataFile = getDataFilename();
        console.log('Loading data from:', dataFile);
        
        fetch(dataFile)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to load data file: ' + dataFile);
                }
                return response.json();
            })
            .then(data => {
                console.log('Data loaded successfully:', data);
                initializeReport(data);
            })
            .catch(error => {
                console.error('Error loading report data:', error);
                document.getElementById('reportTitle').textContent = '‚ùå Error Loading Report';
                document.getElementById('mainContainer').innerHTML += 
                    '<div style="text-align: center; padding: 40px; color: #ef4444;">' +
                    '<h2>Failed to Load Report Data</h2>' +
                    '<p>Error: ' + error.message + '</p>' +
                    '<p>Please ensure the data file "' + dataFile + '" exists in the same directory as this HTML file.</p>' +
                    '</div>';
            });
    </script>
</body>
</html>

